<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google GiriÅŸ</title>
  <style>
    body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .card { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center; max-width: 400px; width: 90%; }
    h2 { color: #333; margin-bottom: 10px; }
    p { color: #666; font-size: 14px; margin-bottom: 20px; }
    .btn { display: inline-flex; align-items: center; gap: 10px; padding: 14px 28px; background: white; border: 2px solid #ddd; border-radius: 12px; font-size: 16px; font-weight: 600; color: #333; cursor: pointer; transition: all 0.2s; }
    .btn:hover { border-color: #4285f4; background: #f8f9ff; }
    .status { margin-top: 15px; font-size: 13px; color: #888; }
    .error { color: #e74c3c; }
    .success { color: #27ae60; }
    .spinner { display: none; margin: 20px auto; width: 40px; height: 40px; border: 4px solid #ddd; border-top: 4px solid #4285f4; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="card">
    <h2>ğŸ” Google ile GiriÅŸ</h2>
    <p>GÃ¶rev Takip uygulamasÄ±na giriÅŸ yapmak iÃ§in Google hesabÄ±nÄ±zÄ± kullanÄ±n.</p>
    
    <button class="btn" id="loginBtn" onclick="googleLogin()">
      <svg width="20" height="20" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/></svg>
      Google ile GiriÅŸ Yap
    </button>
    
    <div class="spinner" id="spinner"></div>
    <p class="status" id="status"></p>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, GoogleAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDTYYB7nfFwwlBFaZ67pjPcv2yrOVk511I",
      authDomain: "drmws-78227.firebaseapp.com",
      projectId: "drmws-78227",
      storageBucket: "drmws-78227.firebasestorage.app",
      messagingSenderId: "68627643543",
      appId: "1:68627643543:web:dbbd6388c144d169a3bdd2"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    window.googleLogin = async function() {
      const statusEl = document.getElementById('status');
      const spinner = document.getElementById('spinner');
      const btn = document.getElementById('loginBtn');
      
      try {
        btn.style.display = 'none';
        spinner.style.display = 'block';
        statusEl.textContent = 'Google hesabÄ±nÄ±za yÃ¶nlendiriliyorsunuz...';
        statusEl.className = 'status';

        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        const idToken = await user.getIdToken();
        
        spinner.style.display = 'none';
        statusEl.textContent = 'âœ… GiriÅŸ baÅŸarÄ±lÄ±! Uygulama aÃ§Ä±lÄ±yor...';
        statusEl.className = 'status success';
        
        // Token'Ä± URL hash'e koy ve custom scheme ile uygulamaya yÃ¶nlendir
        const userData = {
          idToken: idToken,
          email: user.email,
          displayName: user.displayName,
          uid: user.uid,
          photoURL: user.photoURL
        };
        
        // localStorage'a kaydet (aynÄ± origin'de eriÅŸilebilir)
        localStorage.setItem('google_auth_result', JSON.stringify(userData));
        
        // Uygulamaya geri dÃ¶n
        // Deep link ile Capacitor uygulamasÄ±na token gÃ¶nder
        const callbackUrl = `com.drmws.gorevtakip://auth?token=${encodeURIComponent(idToken)}&email=${encodeURIComponent(user.email)}&name=${encodeURIComponent(user.displayName || '')}`;
        
        // Ã–nce custom scheme dene
        window.location.href = callbackUrl;
        
        // 2 saniye sonra hala buradaysak, sayfada bilgi gÃ¶ster
        setTimeout(() => {
          statusEl.innerHTML = `âœ… GiriÅŸ baÅŸarÄ±lÄ±: <strong>${user.email}</strong><br><br>Uygulamaya dÃ¶nÃ¼n ve sayfayÄ± yenileyin.<br><br><small>Token kopyalandÄ±.</small>`;
          // Token'Ä± clipboard'a kopyala
          navigator.clipboard.writeText(idToken).catch(() => {});
        }, 2000);
        
      } catch (error) {
        console.error('Login error:', error);
        spinner.style.display = 'none';
        btn.style.display = 'inline-flex';
        statusEl.textContent = `âŒ Hata: ${error.code || ''} - ${error.message || error}`;
        statusEl.className = 'status error';
      }
    };
  </script>
</body>
</html>
